## You Look Good In Print

## Модели предметной области
- принимаем ADR об инструменте для составления диаграмм моделей предметной области
[0008-use-mermaid-entity-relationship-diagram-for-domain-modeling.md](architecture/decisions/0008-use-mermaid-entity-relationship-diagram-for-domain-modeling.md)

- Получаем диаграмму моделей предметной области
```mermaid
---
config:
  layout: elk
---

erDiagram
    Пользователь ||--o{ Документ : владеет
    Пользователь {
        int id
        string имя
        string email
        string телефон
        string роль "клиент, админ, оператор магазина"
    }

    Документ ||--o{ ВерсияДокумента : имеет
    Документ ||--o{ ЗаказПечати : запрошен_для
    Документ {
        int id
        string название
        string тип "текст, презентация"
        int владелец "userId"
        int ссылка на шаблон
    }

    ВерсияДокумента ||--o{ ШаблонДокумента :  может_использовать
    ВерсияДокумента {
        int id
        int ссылка на документ
        int номер версии
        datetime дата создания
        string ссылка на содержимое "storageId"
    }

    ШаблонДокумента ||--o{ Документ :  используется_в
    ШаблонДокумента {
        int id
        string название
        string категория "бизнес, учеба и т.д."
    }

    ЗаказПечати ||--|| Транзакция : оплачивается_через
    ЗаказПечати ||--|| Магазин : запланирован_в
    ЗаказПечати {
        int id
        int документ "documentId"
        int магазин "storeId"
        int количество_копий
        string параметры "цвет, формат, двусторонняя"
        string статус "запланирован, печатается, готов, выдан"
        datetime расписание "дата/время"
    }

    Транзакция ||--|| Магазин : связан_с
    Транзакция {
        int id
        int привязка_к_магазину "storeId"
        decimal сумма
        string статус "успешно, отклонено"
        string метод_оплаты "онлайн, наличные в магазине"
    }

    Магазин ||--o{ ЗаказПечати : получает
    Магазин {
        int id
        string название
        string адрес
    }

```

Основные связи:
- Пользователь → Документы (многие)
- Документ → Версии (многие)
- Документ → ЗаказПечати (многие)
- ЗаказПечати → Транзакция (1..1)
- ЗаказПечати → Магазин (1..1)
- Шаблон → используется в Документах

## Функциональная декомпозиция
- принимаем ADR об инструменте для составления диаграмм функциональной декомпозии
[0009-use-mermaid-flowcharts-for-functional-decomposition.md](architecture/decisions/0009-use-mermaid-flowcharts-for-functional-decomposition.md)
- Получаем диаграмму функциональной декомпозии
```mermaid
---
config:
  flowchart:
    curve: bump
---

flowchart TB
    title("Функциональное декомпозиция системы 'Все-в-одном'")
    subgraph Users["Пользователи"]
        U1[Клиенты]
        U2[Операторы магазинов]
        U3[Администраторы]
    end

    subgraph System["Система 'Все-в-одном'"]
        subgraph A["[A]Пользователи_и_доступ"]
            A1[Регистрация/Авторизация]
            A2[Управление профилем]
            A3[Подписки и тарифы]
        end

        subgraph B["[B]Управление_документами"]
            B1[Создание документа]
            B2[Редактирование онлайн]
            B3[Хранение в облаке]
            B4[Версионирование]
        end

        subgraph C["[C]Шаблоны"]
            C1[Каталог шаблонов]
            C2[Поиск и фильтрация]
            C3[Использование в документах]
        end

        subgraph D["[D]Заказы_печати"]
            D1[Создание заказа]
            D2[Выбор магазина/времени]
            D3[Настройки печати]
            D4[Статусы заказа]
        end

        subgraph E["[E]Платежи_и_биллинг"]
            E1[Онлайн-оплата]
            E2[POS/наличные]
            E3[История транзакций]
            E4[История оплат]
        end

        subgraph F["[F]Управление_магазинами"]
            F1[Регистрация магазина]
            F2[Привязка оборудования]
            F3[Управление очередью]
        end

        subgraph G["[G]Инфраструктура"]
            G1[Хранилище документов]
            G2[Уведомления]
            G3[Мониторинг и логирование]
            G4[API-шлюз]
        end
    end

%% Взаимосвязи
    U1 --> A
    U1 --> B
    U1 --> C
    U1 --> D
    U1 --> E

    U2 --> D
    U2 --> F

    U3 --> A
    U3 --> F
    U3 --> G

    D --> E
    D --> F
    B --> C
    B --> G1
    System --> G

```

Разделим систему на подсистемы/сервисы:

A. Пользователи и доступ

- Регистрация / авторизация (OAuth, соцсети, email+пароль)
- Управление профилем
- Управление подписками и тарифами

B. Управление документами
- Создание документа (с нуля или из шаблона)
- Редактирование (онлайн редактор текста/презентаций)
- Хранение в облаке
- Версионирование (история изменений, откат)
- Совместный доступ (опционально)

C. Шаблоны
- Каталог шаблонов
- Поиск и фильтрация
- Использование как стартовой точки

D. Заказы печати
- Формирование заказа
- Выбор магазина и времени
- Настройки печати (цвет, двусторонняя, формат бумаги)
- Управление статусами заказа
- Интеграция с системой печати магазина

E. Платежи и биллинг
- Онлайн-оплата (карты, Apple Pay/Google Pay)
- Оплата в магазине (POS-терминал, наличные)
- Управление транзакциями
- История оплат

F. Управление магазинами
- Регистрация и настройка магазинов
- Привязка оборудования печати
- Управление очередью заказов

G. Инфраструктура
- Хранилище документов (S3 или аналог)
- Логирование и мониторинг
- Система уведомлений (email, push, SMS)
- API-шлюзы для интеграции
